$vm.add_record=function(n){var e=n.pid,r=n.records,i=n.I,f=n.row_data,h=n.dbv,u=n.callback,t=$vm.vm[e].db_pid,s;if(t===undefined){alert("No db pid");return}t=t.toString();var c=$("#excel"+e).handsontable("getInstance"),l=c.getCell(i,0),o=$(l).closest("tr");o.find("input[type=file]").each(function(){var i=this.files.length;if(i===1){var n=$(this).closest("td"),t=n.data("filename_field"),r=f[t];n.data("filename",r),f[t]="upload unsuccessful"}}),s={cmd:"add_record",db_pid:t.toString(),data:f,dbv:h},$VmAPI.request({data:s,callback:function(n){r[i].ID=n.ret,r[i].dirty="0",r[i].valid="1";var f=0;o.find("input[type=file]").each(function(){var o=$(this).closest("td"),n,e;f=this.files.length,f===1&&(n=this.files[0],e=r[i].ID,$vm.uploading({file:n,ID:t,rid:e,filename:n.name,callback:function(){var f=o.data("filename"),s=o.data("filename_field"),n={},i,r;n[s]=f,i={},r={cmd:"modify_record",rid:e,db_pid:t,data:n,dbv:i},$VmAPI.request({data:r,callback:function(n){u!==undefined&&u(n,1)}})}}),$(this).closest("form")[0].reset())}),f===0&&u!==undefined&&u(n,1)}})},$vm.add_record_v2=function(n){var f=n.pid,r=n.records,i=n.I,e=n.row_data,h=n.dbv,u=n.callback,t=undefined,s;if(t=f!==undefined?$vm.vm[f].db_pid:n.db_pid,t===undefined){alert("No db pid");return}t=t.toString();var c=$("#excel"+f).handsontable("getInstance"),l=c.getCell(i,0),o=$(l).closest("tr");o.find("input[type=file]").each(function(){var i=this.files.length;if(i===1){var n=$(this).closest("td"),t=n.data("filename_field"),r=e[t];n.data("filename",r),e[t]="upload unsuccessful"}}),s={cmd:"add_record",db_pid:t.toString(),data:e,dbv:h},$VmAPI.request({data:s,callback:function(n){r[i].ID=n.ret,r[i].dirty="0",r[i].valid="1";var f=0;o.find("input[type=file]").each(function(){var o=$(this).closest("td");if(f=this.files.length,f===1){var n=this.files[0],e=r[i].ID,s=function(){var f=o.data("filename"),s=o.data("filename_field"),n={},i,r;n[s]=f,i={},r={cmd:"modify_record",rid:e,db_pid:t,data:n,dbv:i},$VmAPI.request({data:r,callback:function(n){u!==undefined&&u(n,"add")}})};$vm.uploading_v2({file:n,ID:t,rid:e,filename:n.name,callback:function(){n.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)?$vm.uploading_thumb_image({file:n,ID:t,rid:e,filename:n.name,callback:function(){s()}}):s()}}),$(this).closest("form")[0].reset()}}),f===0&&u!==undefined&&u(n,"add")}})},$vm.grid_add_record=function(n){var o=n.pid,r=n.records,u=n.I,i=n.row_data,s=n.dbv,f=n.callback,h=n.tr,t=undefined,e;if(t=o!==undefined?$vm.vm[o].db_pid:n.db_pid,t===undefined){alert("No db pid");return}t=t.toString(),h.find("input[type=file]").each(function(){var r=this.files.length;if(r===1){var n=$(this).closest("td"),t=n.data("filename_field"),u=i[t];n.data("filename",u),i[t]="upload unsuccessful"}}),e={cmd:"add_record",db_pid:t.toString(),data:i,dbv:s},n.json==1&&(e={cmd:"add_json_record",db_pid:t.toString(),data:i,dbv:s}),$VmAPI.request({data:e,callback:function(t){r[u].ID=t.ret,r[u].dirty="0",r[u].valid="1";var i=0,e=function(n){i--,i==0&&f(n,"add")};h.find("input[type=file]").each(function(){var t=this.files.length;t===1&&i++,$vm.td_upload_file_for_add(this,e,n)}),i===0&&f!==undefined&&f(t,"add")}})},$vm.td_upload_file_for_add=function(n,t,i){var o=i.pid,s=i.records,h=i.I,v=i.row_data,y=i.dbv,a=i.callback,p=i.tr,r=s[h].ID,u=undefined,e,c;if(u=o!==undefined?$vm.vm[o].db_pid:i.db_pid,e=$(n).closest("td"),c=n.files.length,c===1){var f=n.files[0],r=s[h].ID,l=function(){var s=e.data("filename"),h=e.data("filename_field"),n={},f,o;n[h]=s,f={},o={cmd:"modify_record",rid:r,db_pid:u,data:n,dbv:f},i.json==1&&(o={cmd:"modify_json_record",rid:r,db_pid:u.toString(),data:n,dbv:f}),$VmAPI.request({data:o,callback:function(n){a!==undefined&&t(n,"add")}})};$vm.uploading_v2({file:f,ID:u,rid:r,filename:f.name,callback:function(){f.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)?$vm.uploading_thumb_image({file:f,ID:u,rid:r,filename:f.name,callback:function(){l()}}):l()}}),$(n).closest("form")[0].reset()}},$vm.add_record_s2=function(n){n.json==1?$vm.add_record_special("add_json_record_s2",n):$vm.add_record_special("add_record_s2",n)},$vm.add_record_without_permission=function(n){$vm.add_record_special("add_record_without_permission",n)},$vm.add_record_special=function(n,t){var e=t.pid,r=t.records,u=t.I,s=t.row_data,h=t.dbv,f=t.callback,c=t.tr,i=undefined,o;if(i=e!==undefined?$vm.vm[e].db_pid:t.db_pid,i===undefined){alert("No db pid");return}i=i.toString(),o={cmd:n,db_pid:i.toString(),data:s,dbv:h},$VmAPI.request({data:o,callback:function(n){r[u].ID=n.ret,r[u].dirty="0",r[u].valid="1";var t=0;c.find("input[type=file]").each(function(){var s=$(this).closest("td"),e,o;t=this.files.length,t===1&&(e=this.files[0],o=r[u].ID,$vm.uploading_v2({file:e,ID:i,rid:o,filename:e.name,callback:function(){e.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)&&$vm.uploading_thumb_image({file:e,ID:i,rid:o,filename:e.name,callback:function(){f!==undefined&&f(n,1)}})}}),$(this).closest("form")[0].reset())}),t===0&&f!==undefined&&f(n,1)}})},$vm.is_valid_url=function(n){var t=n.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);return t==null?!1:!0},$vm.css_process=function(n,t){for(var h=n.replace(/\r/g,"").replace(/\n/g,""),r="",s=h.split("}"),f,o,e,i,u=0;u<s.length;u++)if(f=s[u].split("{"),f.length==2){for(r+=f[0].trim()+"{\r\n",o=f[1].split(";"),e=0;e<o.length;e++)i=o[e].split(":"),i.length==2&&t.includes(i[0].trim())==!0&&(r+="    "+i[0].trim()+":"+i[1].trim()+";\r\n");r+="}\r\n"}return r},$vm.content_filter=function(n,t,i,r){var f=$("<div><\/div>").html(n),u="",e=f.find("*");return e.each(function(){var e=$(this).prop("tagName").toLowerCase(),n;t.includes(e)==!1?(e=="style"&&(u+=$(this).text().toLowerCase()+"\r\n"),f.find(this).remove()):(n=$(this),$.each(this.attributes,function(t,u){var f,e,o;u!=undefined&&(f=u.name.toLowerCase(),i.includes(f)==!1?n.removeAttr(f):(e=u.value,f=="src"||f=="href"?$vm.is_valid_url(e)==!1&&n.removeAttr(f):f=="style"&&(o="@@@{"+u.value+"}",u.value=$vm.css_process(o,r).replace("@@@{","").replace("}","").replace(/\r/g,"").replace(/\n/g,""))))}))}),u=$vm.css_process(u,r),f.html()+"\r\n<style>"+u+"<\/style>"},$vm.date_add_days=function(n,t){var i=n.getTime()+864e5*t,r=n.getTime()+(864e5*t+36e5),e=new Date(i),u=new Date(r),f=(u.getTimezoneOffset()-n.getTimezoneOffset())*6e4;return new Date(i+f)},$vm.date_to_string_dmy=function(n){return $vm.pad(n.getDate(),2)+"/"+$vm.pad(n.getMonth()+1,2)+"/"+n.getFullYear()},$vm.pad=function(n,t){var i="000000000"+n;return i.substr(i.length-t)},$vm.date_parse=function(n){try{var t=n.split("/");return new Date(t[2],t[1]-1,t[0])}catch(i){return new Date(1800,0,1)}},$vm.date_weekfirst=function(n){var t=new Date(n),i=t.getDay(),r=t.getDate()-i+(i==0?-6:1);return new Date(t.setDate(r))},$vm.date_day_diff=function(n,t){var i=(t.getTimezoneOffset()-n.getTimezoneOffset())*6e4;return Math.floor((t.getTime()-n.getTime()-i)/864e5)},$vm.first_day_of_current_month=function(){var n=new Date,t=n.getFullYear(),i=n.getMonth();return new Date(t,i,1,0,0,0,0)},$vm.first_day_of_current_year=function(){var n=new Date,t=n.getFullYear(),i=new Date(t,0,1);return $vm.date_to_string_dmy(i)},$vm.time12=function(n){var i=n,r=n.split(":"),t=parseInt(r[0])-12;return t>=0?(t==0&&(t=12),i=$vm.pad(t,2)+":"+r[1]+"pm"):(t=t+12,t==0&&(t=12),i=$vm.pad(t,2)+":"+r[1]+"am"),i},$vm.date_today=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)},$vm.date_yyyymmdd_parse=function(n){try{var t=n.split("-");return new Date(t[0],t[1]-1,t[2])}catch(i){return new Date(1800,0,1)}},$vm.au_date_to_string_yyyymmdd=function(n){var t,i;return n==undefined?"":(t=n.split("/"),t.length==3&&t[2].length==4?(i=new Date(t[2],t[1]-1,t[0]),i.getFullYear()+"-"+$vm.pad(i.getMonth()+1,2)+"-"+$vm.pad(i.getDate(),2)):n)},$vm.date_to_string_yyyymmdd=function(n){return n.getFullYear()+"-"+$vm.pad(n.getMonth()+1,2)+"-"+$vm.pad(n.getDate(),2)},$vm.source=function(n,t){var i,f,e,u,r,o;t.altKey?$vm.vm[n].url!==undefined&&(r="__COMPONENT__/code_viewer/code.html",i=$vm.vm[n].url,i[0]=="/"?i=$vm.hosting_path+i:i.substring(0,7)!="http://"&&i.substring(0,8)!="https://"&&(i=$vm.hosting_path+"/"+i),$.get(i+"?"+(new Date).getTime(),function(t){var u=$vm.vm[n].name,f;$vm.module_list[u]!==undefined&&($vm.module_list[u].html_filter!=undefined&&(t=$vm.module_list[u].html_filter(t)),f=Array.isArray($vm.module_list[u])===!0?"module name: "+u+", database table id: "+$vm.module_list[u][0]+", path: "+$vm.module_list[u][1]:"module name: "+u+", database table id: "+$vm.module_list[u].table_id,$vm.module_list.sys_code_viewer==undefined&&($vm.module_list.sys_code_viewer={url:r}),$vm.load_module_v2("sys_code_viewer","",{code:t,name:f,url:i}))})):t.ctrlKey?(u=JSON.stringify($vm.module_list,null,4),u=$("<div><\/div>").html(u).text(),r="__COMPONENT__/code_viewer/code.html",$vm.module_list.sys_code_viewer==undefined&&($vm.module_list.sys_code_viewer={url:r}),$vm.load_module_v2("sys_code_viewer","",{code:u,name:"modules",url:""})):t.shiftKey&&(f=$vm.vm[n].name,e={},e[f]=$vm.module_list[f],u=JSON.stringify(e,null,4),u=$("<div><\/div>").html(u).text(),r="__COMPONENT__/code_viewer/code.html",o={name:"code_viewer",pid:$vm.id(r+"--------"),slot:$vm.root_layout_content_slot,url:$vm.url(r),op:{name:"System info",code:u}},$vm.load_module(o))},$vm.url_source=function(n){$.get(n+"?"+(new Date).getTime(),function(t){var i={name:"code_viewer",pid:$vm.id(n+"--------"),slot:$vm.root_layout_content_slot,url:$vm.url("__COMPONENT__/code_viewer/code.html"),op:{name:n,code:t}};$vm.load_module(i)},"text")},$vm.view_code=function(n,t){t==undefined&&(t="Code");var i={name:"code_viewer",pid:$vm.id("--------"),slot:$vm.root_layout_content_slot,url:$vm.url("__COMPONENT__/code_viewer/code.html"),op:{name:t,code:n}};$vm.load_module(i)},$vm.delete_record=function(n){var t=n.pid,f=n.rid,e=n.dbv,i=n.callback,r="0",o,u;t!=undefined&&$vm.vm[t]!==undefined&&$vm.vm[t].db_pid!==undefined&&(r=$vm.vm[t].db_pid),r=="0",o=!1,u={cmd:"delete_record",rid:f,db_pid:r.toString(),dbv:e},$vm.third_party!=1?$VmAPI.request({data:u,callback:function(n){if(n.Error!==undefined)return!1;if(n.ret=="NULL")return n.msg!==undefined?alert(n.msg):alert("No permission!"),!1;i!==undefined&&i(n,"delete")}}):$vm.third_party==1&&$vm.post_message_from_child_to_parent({data:u,origin:"*",callback:function(n){if(n.Error!==undefined)return!1;if(n.ret=="NULL")return n.msg!==undefined?alert(n.msg):alert("No permission!"),!1;i!==undefined&&i(n,"delete")}})},$vm.delete_record_s2=function(n){var t=n.pid,f=n.rid,e=n.dbv,r=n.callback,i="0",o,u;if($vm.vm[t]!==undefined&&$vm.vm[t].db_pid!==undefined&&(i=$vm.vm[t].db_pid),i=="0"){alert("No db pid");return}o=!1,u={cmd:"delete_record_s2",rid:f,db_pid:i.toString(),dbv:e},$VmAPI.request({data:u,callback:function(n){if(n.Error!==undefined)return!1;if(n.ret=="NULL")return n.msg!==undefined?alert(n.msg):alert("No permission!"),!1;r!==undefined&&r(n,"delete")}})},$vm.lock_parent=function(n){var t=n.rid,i={cmd:"lock_parent",rid:t};$VmAPI.request({data:i,callback:function(n){n.Error===undefined&&n.ret=="NULL"&&(n.msg!==undefined?alert(n.msg):alert("No permission!"))}})},$vm.unlock_parent=function(n){var t=n.rid,i={cmd:"unlock_parent",rid:t};$VmAPI.request({data:i,callback:function(n){n.Error===undefined&&n.ret=="NULL"&&(n.msg!==undefined?alert(n.msg):alert("No permission!"))}})},$vm.lock=function(n){var t=n.rid,i={cmd:"lock",rid:t};$VmAPI.request({data:i,callback:function(n){n.Error===undefined&&n.ret=="NULL"&&(n.msg!==undefined?alert(n.msg):alert("No permission!"))}})},$vm.unlock=function(n){var t=n.rid,i={cmd:"unlock",rid:t};$VmAPI.request({data:i,callback:function(n){n.Error===undefined&&n.ret=="NULL"&&(n.msg!==undefined?alert(n.msg):alert("No permission!"))}})},$vm.autocomplete=function(n,t,i){var r=n.attr("data-id");return n.focus(function(){n.autocomplete("search","")}),n.autocomplete({minLength:0,source:function(n,i){$VmAPI.request({data:{cmd:"auto",s1:n.term,sql:t,minLength:0},callback:function(n){i($vm.autocomplete_list(n.table))}})},select:function(n,t){if(i!=undefined){i(r+"_uid",t.item.value2);for(key in t.item)if(key.indexOf("field_")!==-1){var u=key.replace("field_",""),f=t.item[key];i(u,f)}}}})},$vm.render_checkbox_field=function(n,t,i,r){var u=i.attr("data-id");n.vm_custom[u]=!0,i.html(r),(n[u]=="1"||n[u]=="True"||n[u]=="on")&&i.find("input").prop("checked",!0);i.find("input").on("click",function(){var i="0";($(this).prop("checked")==!0&&(i="1"),i!==""||n[u]!==undefined)&&i!==n[u]&&(n.vm_dirty=1,n[u]=i,$("#save"+t).css("background","#E00"))})},$vm.render_color_field=function(n,t,i,r){n===undefined&&(n={});var u=i.attr("data-id");n.vm_custom[u]=!0,i.html(r),i.find("input").val(n[u]);i.find("input").on("input",function(){var i=$(this).val();(i!==""||n[u]!==undefined)&&i!==n[u]&&(n.vm_dirty=1,n[u]=i,$("#save"+t).css("background","#E00"))})},$vm.render_date_field=function(n,t,i,r){n===undefined&&(n={});var u=i.attr("data-id");n.vm_custom[u]=!0,i.html(r),i.find("input").val(n[u]);i.find("input").on("input",function(){var i=$(this).val();(i!==""||n[u]!==undefined)&&i!==n[u]&&(n.vm_dirty=1,n[u]=i,$("#save"+t).css("background","#E00"))})},$vm.render_file_field=function(n,t,i,r){var f,u,e;n===undefined&&(n={}),f=i.attr("data-id"),u="",n!=undefined&&(u=n[f]),u==undefined&&(u=""),e="<u style='cursor:pointer'>"+$vm.text(u)+"<\/u>",e+="<span class=file_button"+t+"> <a class=choose_file"+t+" title='Choose a file'><i class='fa fa-file'><\/i><\/a><\/span>",e+="<input type=file name="+f+" style='display:none'><\/input>",i.html(e);i.find("u").on("click",function(){var t=n.ID;t!==undefined?(u=n[f],u==undefined&&(u=""),u!=""&&$vm.open_link({rid:t,filename:u})):alert("No file was found on server.")});i.find("a.choose_file"+t).on("click",function(){i.find("input[type=file]").trigger("click")});i.find("input[type=file]").on("change",function(){var u="",f="";this.files.length==1?(i.find("u").html(this.files[0].name),u=this.files[0].size,f=$vm.date_to_string_yyyymmdd(new Date(this.files[0].lastModified))):i.find("u").html(""),n!=undefined&&(n.vm_dirty=1),$("#save"+t).css("background","#E00"),r!=undefined&&r(u,f)})},$vm.upload_form_files=function(n,t,i){var u=function(n,t,i){$vm.uploading_v2({file:t,rid:n,filename:t.name,callback:function(){t.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)?$vm.uploading_thumb_image({file:t,rid:n,filename:t.name,callback:function(){i()}}):i()}})},r=0;t.find("input[type=file]").each(function(){this.files.length===1&&r++}),r!=0?t.find("input[type=file]").each(function(){this.files.length===1&&u(n,this.files[0],function(){r--,r==0&&i()})}):i()},$vm.set_file_name_as_upload_unsuccessful=function(n,t){var i=0;return t.find("input[type=file]").each(function(){if(this.files.length===1){var t=$(this).attr("name");n[t]="upload unsuccessful",i++}}),i},$vm.get_original_file_name=function(n){var t={};return n.find("input[type=file]").each(function(){if(this.files.length===1){var n=$(this).attr("name");t[n]=this.files[0].name}}),t},$vm.render_image_field=function(n,t,i){var s=function(n,i,r,u){if(i!==undefined){var c=r.split(".").pop(),l=r+"_thumb."+c,f="S"+i;if($vm.vm[t][f]!==undefined)n.attr("src",$vm.vm[t][f]);else{var o="S"+i+new Date(u).getTime()+"_"+$vm.version,s="D"+i+new Date(u).getTime()+"_"+$vm.version,h=localStorage.getItem(o),a=localStorage.getItem(s),v=new Date(a),y=new Date,e=y.getTime()-v.getTime();e=e/864e5,h!==null&&e<6?n.attr("src",h):$vm.s3_link({rid:i,filename:l,days:"7",modified:u,callback:function(i){$vm.vm[t][f]=i,n.attr("src",i),localStorage.setItem(o,i),localStorage.setItem(s,(new Date).toString())}})}}},h=function(n,i,r){var u="L"+n,e,f;$vm.vm[t][u]!==undefined?(e=$vm.vm[t][u],window.open(e,"resizable=1")):(jQuery.ajaxSetup({async:!1}),f="",$vm.s3_link({rid:n,filename:i,days:"1",modified:r,callback:function(n){$vm.vm[t][u]=n,f=n}}),jQuery.ajaxSetup({async:!0}),window.open(f,"Image","resizable=1"))},r,f,e,o,u;if(n===undefined&&(n={}),r=i.attr("data-id"),f="",n!=undefined&&(f=n[r]),f==undefined&&(f=""),e="<span><\/span><img  width='80' style='display:inline-block;cursor:pointer;margin-bottom:0' />",e+="<span class=file_button"+t+"> <a title='Choose a file' class=choose_file"+t+"><i class='fa fa-file'><\/i><\/a><\/span>",e+="<input type=file name="+r+" style='display:none'><\/input>",i.html(e),n!=undefined&&($img=i.find("img"),n[r]!==""&&n[r]!==undefined)){o=n.ID,u=n.Modified,u===undefined&&(u=n.DateTime),s($img,o,n[r],u);$img.on("click",function(){h(o,n[r],u)})}i.find("a.choose_file"+t).on("click",function(){i.find("input[type=file]").trigger("click")});i.find("input[type=file]").on("change",function(){$img=i.find("img"),$img.css("display","none"),this.files.length==1?i.find("span:first").html(this.files[0].name):i.find("span:first").html(""),n.vm_dirty=1,$("#save"+t).css("background","#E00")})},$vm.render_input_field=function(n,t,i,r){n===undefined&&(n={});var u=i.attr("data-id");n.vm_custom[u]=!0,i.html(r),i.find("input").val(n[u]);i.find("input").on("input",function(){var i=$(this).val();(i!==""||n[u]!==undefined)&&i!==n[u]&&(n.vm_dirty=1,n[u]=i,$("#save"+t).css("background","#E00"))})},$vm.postcode=function(n,t){n.autocomplete({minLength:1,source:function(n,t){$VmAPI.request({data:{cmd:"postcode",query:n.term,count:"10"},callback:function(n){t($.parseJSON(n.ret))}})},select:function(n,i){var u=i.item.label.split("/")[0],f=i.item.label.split("/")[1],r=i.item.label.split("/")[2];i.item.value=r,t!=undefined&&t(u,f,r)}})},$vm.suburb=function(n,t){n.autocomplete({minLength:1,source:function(n,t){$VmAPI.request({data:{cmd:"suburb",query:n.term,count:"10"},callback:function(n){t($.parseJSON(n.ret))}})},select:function(n,i){var r=i.item.label.split("/")[0],u=i.item.label.split("/")[1],f=i.item.label.split("/")[2];i.item.value=r,t!=undefined&&t(r,u,f)}})},$vm.render_radio_field=function(n,t,i,r){n===undefined&&(n={});var u=i.attr("data-id");n.vm_custom[u]=!0,i.html(r),i.find('input[value="'+n[u]+'"]').prop("checked",!0);i.find("input").on("click",function(){var i=$(this).val();(i!==""||n[u]!==undefined)&&i!==n[u]&&(n.vm_dirty=1,n[u]=i,$("#save"+t).css("background","#E00"))})},$vm.render_select_field=function(n,t,i,r){n===undefined&&(n={});var u=i.attr("data-id");n.vm_custom[u]=!0,i.html(r),i.find("select").val(n[u]);i.find("select").on("change",function(){var i=$(this).val();(i!==""||n[u]!==undefined)&&i!==n[u]&&(n.vm_dirty=1,n[u]=i,$("#save"+t).css("background","#E00"))})},$vm.file_reference_open_link=function(n){var s=n.td,t=n.value,i,u,r,o,h,c;if((t===null||t===undefined||t==="")&&(t="",s.innerHTML=""),t!==""){for(i="",u=t.split(","),r=0;r<u.length;r++){i!==""&&(i+=", ");var f=u[r].split("-"),l=f[0],a=f[1],e="";for(o=2;o<f.length;o++)e!==""&&(e+="-"),e+=f[o];h=$.parseHTML(e),c=$(h).text(),i+="<u data-m="+u[r]+" style='cursor:pointer'>"+c+"<\/u>"}s.innerHTML=i;$(s).find("u").on("click",function(){for(var r=$(this).attr("data-m"),n=r.split("-"),u=n[0],f=n[1],t="",i=2;i<n.length;i++)t!==""&&(t+="-"),t+=n[i];$vm.open_link({pid:u,uid:f,filename:t})})}},$vm.open_link=function(n){var i=n.rid,r=n.pid,u=n.uid,t=n.filename,f=n.days,o=n.modified,e={cmd:"s3_download_url",rid:i,pid:r,uid:u,filename:t};f!==undefined&&(e={cmd:"s3_download_url_days",rid:i,pid:r,uid:u,filename:t,days:f.toString(),modified:o}),$VmAPI.request({data:e,callback:function(n){var i=document.createElement("a"),r;i.href=n.s3_download_url,i.style="visibility:hidden",r=t.split("-"),i.download=t.replace(r[0]+"-","").replace(/ /g,"_"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}})},$vm.s3_link=function(n){var t=n.rid,i=n.pid,r=n.uid,u=n.filename,f=n.days,s=n.modified,e=n.callback,o={cmd:"s3_download_url",rid:t,pid:i,uid:r,filename:u};f!==undefined&&(o={cmd:"s3_download_url_days",rid:t,pid:i,uid:r,filename:u,days:f.toString(),modified:s}),$VmAPI.request({data:o,callback:function(n){e!==undefined&&e(n.s3_download_url)}})},$vm.set_file_input=function(n){var t=n.td,i=n.filename_field,r=n.callback;$(t).data("filename_field",i),t.innerHTML="<form><button>Choose File<\/button><input type=file style='display:none'><\/input><\/form>";$(t).find("button").on("click",function(){return $(t).find("form")[0].reset(),$(t).find("input[type=file]").trigger("click"),!1});$(t).find("input[type=file]").on("change",function(){var n=this.files[0];r(n)})},$vm.file_link=function(n){var r=n.td,i=n.rid,t=n.value,u;t===undefined&&(t=""),t===null&&(t=""),u="<u style='cursor:pointer'>"+t+"<\/u>",r.innerHTML=u;$(r).find("u").on("click",function(){var n=$(this).html();i!==null&&i!==undefined&&$vm.open_link({rid:i,filename:n})})},$vm.file_reference=function(n){var r=n.td,u=n.PID,t=n.value,i=n.file_name;(t===undefined||i===undefined)&&(t=""),(t===null||i===null)&&(t=""),r.innerHTML=t===""?"":"<input value='"+u+"-"+t+"-"+i+"' readonly style='border:0' />"},$vm.uploading=function(n){var t=n.file,i=n.TD,f=n.rid,e=n.filename,r=n.callback,u;t&&(u={cmd:"s3_upload_url",rid:f,filename:e,contentType:t.type},$VmAPI.request({data:u,callback:function(n){$("#progress_dialog"+i).dialog({height:"auto",width:"auto",modal:!0}),$("#progress"+i).text("Uploading..."),$(".ui-dialog-titlebar").hide(),$.ajax({xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){$("#progress"+i).text(n.loaded)},!1),n},url:n.s3_upload_url,type:"PUT",data:t,headers:{"Content-Type":t.type},cache:!1,processData:!1}).done(function(){$("#progress_dialog"+i).dialog("close"),r!==undefined&&r()}).fail(function(){alert("Upload error")})}}))},$vm.uploading_v2=function(n){var t=n.file,e=n.TD,u=n.rid,f=n.filename,i=n.callback,r;t&&(r={cmd:"s3_upload_url",rid:u,filename:f,contentType:t.type},$VmAPI.request({data:r,callback:function(n){var r,u,f;$vm.open_dialog({name:"uploading_file_dialog_module"}),Array.isArray($vm.module_list.uploading_file_dialog_module)===!0?(r=$vm.module_list.uploading_file_dialog_module[0],u=$vm.module_list.uploading_file_dialog_module[1]):(r=$vm.module_list.uploading_file_dialog_module.table_id,u=$vm.module_list.uploading_file_dialog_module.url),f=$vm.id(u+r),$("#progress"+f).text("Uploading..."),$.ajax({xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){$("#progress"+f).text(n.loaded)},!1),n},url:n.s3_upload_url,type:"PUT",data:t,headers:{"Content-Type":t.type},cache:!1,processData:!1}).done(function(){$vm.close_dialog({name:"uploading_file_dialog_module"}),i!==undefined&&i()}).fail(function(){alert("Upload error")})}}))},$vm.uploading_thumb_image=function(n){var t=n.file,o=n.TD,u=n.rid,f=n.filename,r=n.callback,e=function(n){var i=document.createElement("canvas"),e=new Image;e.src=n.target.result,e.onload=function(){var o,n,c,l;if(i.width=80,i.height=80*e.height/e.width,i.getContext){o=i.getContext("2d"),o.drawImage(e,0,0,i.width,i.height);var a=i.toDataURL(),s=atob(a.split(",")[1]),h=[];for(n=0;n<s.length;n++)h.push(s.charCodeAt(n));c=new Blob([new Uint8Array(h)],{type:"image/"+t.type}),l={cmd:"s3_upload_thumb_url",rid:u,filename:f,contentType:t.type},$VmAPI.request({data:l,callback:function(n){$vm.open_dialog({name:"uploading_file_dialog_module"}),Array.isArray($vm.module_list.uploading_file_dialog_module)===!0?(mid=$vm.module_list.uploading_file_dialog_module[0],url=$vm.module_list.uploading_file_dialog_module[1]):(mid=$vm.module_list.uploading_file_dialog_module.table_id,url=$vm.module_list.uploading_file_dialog_module.url);var i=$vm.id(url+mid);$("#progress"+i).text("Uploading..."),$.ajax({xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){$("#progress"+i).text(n.loaded)},!1),n},url:n.s3_upload_url,type:"PUT",data:c,headers:{"Content-Type":t.type},cache:!1,processData:!1}).done(function(){$vm.close_dialog({name:"uploading_file_dialog_module"}),r!==undefined&&r()}).fail(function(){alert("Upload error")})}})}}},i;t&&(i=new FileReader,i.onload=e,i.readAsDataURL(t))},$vm.download_csv=function(n){var s=n.name,c=n.data,y=n.fields,r,l,h,u,t,v,a,e;if(c!==""){var i="",f="",o=y.split(",");for(r=0;r<o.length;r++)r!==0&&(f+=","),o[r].split("|")[0][0]!="_"&&(f+=o[r].split("|")[0]);for(f+="\r\n",i+=f,t=0;t<c.length;t++){for(f="",r=0;r<o.length;r++)r!==0&&(f+=","),o[r].split("|")[0][0]!="_"&&(l=o[r].split("|").pop().trim().replace("...",""),h="",c[t][l]!==undefined&&(h=c[t][l]),h=h.toString().replace(/"/g,""),f+='"'+h+'"');f+="\r\n",i+=f}for(s=s.replace(/ /g,"_"),u=[],u.push(239),u.push(187),u.push(191),t=0;t<i.length;t++)i.charCodeAt(t)<128?u.push(i.charCodeAt(t)):i.charCodeAt(t)<2048?(u.push(((i.charCodeAt(t)&192)>>6)+((i.charCodeAt(t)&1792)>>6)+192),u.push(i.charCodeAt(t)&191)):i.charCodeAt(t)<65536&&(u.push(((i.charCodeAt(t)&61440)>>12)+224),u.push(((i.charCodeAt(t)&192)>>6)+((i.charCodeAt(t)&3840)>>6)+128),u.push(i.charCodeAt(t)&191));v=new Uint8Array(u),a=new Blob([v]),navigator.appVersion.toString().indexOf(".NET")>0?window.navigator.msSaveBlob(a,s):(e=document.createElement("a"),e.setAttribute("href",window.URL.createObjectURL(a)),e.setAttribute("download",s),e.style="visibility:hidden",e.download=s,document.body.appendChild(e),e.click(),document.body.removeChild(e))}},$vm.set_dropdown_list_from_text=function(n,t){var i=$("<div><\/div>").html(t).text(),f,u;for(i=i.replace(/\r/g,"\n"),i=i.replace(/\n\n/g,"\n"),i=i.replace(/\n/g,","),i=i.replace(/,,/g,","),f=i.split(","),n.html(""),u=0;u<f.length;u++){var o=f[u],r=o.split(";"),e="";r[0].length>0&&r[0]=="*"&&(r[0]=r[0].replace("*",""),e="selected"),r.length==2?n.append($("<option "+e+"><\/option>").val(r[1]).html(r[0])):n.append($("<option "+e+"><\/option>").val(r[0]).html(r[0]))}},$vm.vm_password=function(n,t){var r=0,u="",i,t;for(t==undefined&&(t=!1);r<n;){if(i=Math.floor(Math.random()*100)%94+33,!t){if(i>=33&&i<=47)continue;if(i>=58&&i<=64)continue;if(i>=91&&i<=96)continue;if(i>=123&&i<=126)continue}r++,u+=String.fromCharCode(i)}return u},String.prototype.splitCSV=function(n){for(var t=this.split(n=n||","),i=t.length-1,r;i>=0;i--)t[i].replace(/"\s+$/,'"').charAt(t[i].length-1)=='"'?(r=t[i].replace(/^\s+"/,'"')).length>1&&r.charAt(0)=='"'?t[i]=t[i].replace(/^\s*"|"\s*$/g,"").replace(/""/g,'"'):i?t.splice(i-1,2,[t[i-1],t[i]].join(n)):t=t.shift().split(n).concat(t):t[i].replace(/""/g,'"');return t},$vm.check_and_clear_localstorage=function(){var t="",n;for(n in window.localStorage)window.localStorage.hasOwnProperty(n)&&(t+=window.localStorage[n]);t.length>3e6&&localStorage.clear()},$vm.today_ddmmyyyy=function(){today=new Date;var n=today.getDate(),t=today.getMonth()+1,i=today.getFullYear();return n<10&&(n="0"+n),t<10&&(t="0"+t),today=n+"/"+t+"/"+i},$.fn.mobile_menumaker=function(n){var t=$(this),i=$.extend({format:"dropdown",sticky:!1},n);return this.each(function(){$(this).find(".button").on("click",function(){$(this).toggleClass("menu-opened");var n=$(this).next("ul");n.hasClass("open")?n.slideToggle().removeClass("open"):(n.slideToggle().addClass("open"),i.format==="dropdown"&&n.find("ul").show())});t.find("li ul").parent().addClass("has-sub"),multiTg=function(){t.find(".has-sub").prepend('<span class="submenu-button"><\/span>');t.find(".submenu-button").on("click",function(){$(this).toggleClass("submenu-opened"),$(this).siblings("ul").hasClass("open")?$(this).siblings("ul").removeClass("open").slideToggle():$(this).siblings("ul").addClass("open").slideToggle()})},i.format==="multitoggle"?multiTg():t.addClass("dropdown"),i.sticky===!0&&t.css("position","fixed");var n=function(){var n=900;$(window).width()>n&&t.find("ul").show(),$(window).width()<=n&&t.find("ul").hide().removeClass("open")};n();return $(window).on("resize",n)})},$vm.find_object=function(n,t,i){var u=null,f,r;if(n instanceof Array){for(f=0;f<n.length;f++)if(u=$vm.find_object(n[f],t,i),u)break}else for(r in n){if(r==t&&n[r]==i)return n;if((n[r]instanceof Object||n[r]instanceof Array)&&(u=$vm.find_object(n[r],t,i),u))break}return u},$vm.text=function(n){return $("<div><\/div>").html(n).text()},$vm.status_of_data=function(n){var i=0,r=0,t;for(key in n)r++,n[key]==""&&i++;return t="#FFCC00",i==r?t="#FF0000":i==0&&(t="#00FF00"),t},$vm.init_v3=function(n){var t=n.callback;$vm.vm={},$vm.edge=0,navigator.appVersion.indexOf("Edge")!=-1&&($vm.edge=1),$vm.user="guest",$VmAPI.request({data:{cmd:"user_name",ip:$vm.ip},callback:function(n){n.user!==undefined&&($vm.user=n.user,$vm.user_id=n.user_id,$vm.user_ip=n.user_ip,$vm.user_puid=n.user_puid),t!==undefined&&t(n),$vm.ip="";try{window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var i=new RTCPeerConnection({iceServers:[]}),r=function(){};i.createDataChannel(""),i.createOffer(i.setLocalDescription.bind(i),r),i.onicecandidate=function(n){n&&n.candidate&&n.candidate.candidate&&($vm.ip=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(n.candidate.candidate)[1],i.onicecandidate=r,$VmAPI.request({data:{cmd:"user_ip",ip:$vm.ip,name:$vm.user},callback:function(){}}))}}catch(u){$VmAPI.request({data:{cmd:"user_ip",ip:"0.0.0.0",name:$vm.user},callback:function(){}})}}})},$vm.init=function(n){$vm.repository==undefined&&($vm.repository=""),$vm.set_category();var t=n.callback;$vm.itemuid="",$vm.appid="",$vm.idapp="",$vm.ticks="",$vm.appuid="",$vm.uidapp="",$vm.user="",$vm.user_id="",$vm.user_ip="",$vm.guest=1,$vm.owner=1,$vm.current_module="",$vm.current_form="",$vm.current_grid="",$vm.current_main="",$vm.current_left="",$vm.comm=0,$vm.itemuid="",$vm.appid="",$vm.idapp="",$vm.ticks="",$vm.update_key="",$vm.submit_btn="",$vm.module_border="0",$vm.vm={},$vm.edge=0,navigator.appVersion.indexOf("Edge")!=-1&&($vm.edge=1),g_itemuid="",g_appid="",g_idapp="",g_ticks="",g_appuid="",g_uidapp="",g_user="",g_guest=1,g_owner=1,g_current_module="",g_current_form="",g_current_grid="",g_current_main="",g_current_left="",g_comm=0,g_itemuid="",g_appid="",g_idapp="",g_ticks="",g_update_key="",g_submit_btn="",g_module_border="0",typeof g_vm=="undefined"&&(g_vm={}),$("body").html("<div id=vm_body><\/div><div id=vm_park style='display:none'><\/div>"),$("html").bind("ajaxStart",function(){$(this).addClass("busy")}).bind("ajaxStop",function(){$(this).removeClass("busy")}),g_user="guest",g_user_id="0",g_user_ip="",$vm.user="guest",$VmAPI.request({data:{cmd:"user_name"},callback:function(n){n.user!==undefined&&($vm.user=n.user,$vm.user_id=n.user_id,$vm.user_ip=n.user_ip),t!==undefined&&t(n),$vm.ip="";try{window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var i=new RTCPeerConnection({iceServers:[]}),r=function(){};i.createDataChannel(""),i.createOffer(i.setLocalDescription.bind(i),r),i.onicecandidate=function(n){n&&n.candidate&&n.candidate.candidate&&($vm.ip=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(n.candidate.candidate)[1],i.onicecandidate=r,$VmAPI.request({data:{cmd:"user_ip",ip:$vm.ip,name:$vm.user},callback:function(){}}))}}catch(u){$VmAPI.request({data:{cmd:"user_ip",ip:"0.0.0.0",name:$vm.user},callback:function(){}})}}})},$vm.jquery_validator_init=function(){$.validator.addMethod("regex",function(n,t,i){var r=new RegExp(i[0]);return this.optional(t)||r.test(n)},$.validator.format("{1}")),$.validator.setDefaults({ignore:"",errorPlacement:function(n,t){t.attr("type")=="radio"?(t.parent().append("<br>"),n.appendTo(t.parent())):n.insertAfter(t)}})},$vm._id=-1,$vm.id=function(){return $vm._id++,"_"+$vm._id.toString()},$vm.load_demo=function(){var n=window.location.search.split("n=").pop(),i,t,r;n!==""&&(Array.isArray($vm.module_list[n])===!0?(i=$vm.module_list[n][0],t=$vm.module_list[n][1]):(i=$vm.module_list[n].table_id,t=$vm.module_list[n].url),r={name:n,pid:$vm.id(t+i),slot:$vm.root_layout_content_slot,url:$vm.url(t),op:{}},$vm.load_module(r),$vm.demo_background())},$vm.set_category=function(){var n;$vm.category="",$vm.subcategory="",n=$vm.get_parameter("category"),n!=null&&($vm.category=n),n=$vm.get_parameter("subcategory"),n!=null&&($vm.subcategory=n)},$vm.get_parameter=function(n,t){t||(t=window.location.href),n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},$vm.load_config_and_init=function(n,t){var i=$vm.hosting_path+n,u=localStorage.getItem(i+"_ver"),r=localStorage.getItem(i+"_txt");u!=$vm.version||r===null||$vm.debug===!0||$vm.reload!=""?(console.log("loading "+i+"?_="+$vm.version+$vm.reload),$.get(i+"?_="+$vm.version+$vm.reload,function(n){localStorage.setItem(i+"_txt",n),localStorage.setItem(i+"_ver",$vm.version),$vm._panel_init(n,t)},"text").fail(function(){alert("The configuration file ("+i+") doesn't exist!")})):$vm._panel_init(r,t)},$vm._panel_init=function(n,t){var e=$("<div><\/div>").html(n).text(),r,i,f,u;try{r=JSON.parse(e)}catch(o){alert("Error in app config file\n"+o);return}i=r.group,i=i==undefined?"":i+"_",f=r.modules;for(u in f)$vm.module_list[i+u]==undefined&&($vm.module_list[i+u]=f[u]);t!=undefined&&t(r)},$vm.init2=function(n){$vm.repository==undefined&&($vm.repository=""),$vm.set_category();var t=n.callback;$vm.vm={},$vm.edge=0,navigator.appVersion.indexOf("Edge")!=-1&&($vm.edge=1),$("html").bind("ajaxStart",function(){$(this).addClass("busy")}).bind("ajaxStop",function(){$(this).removeClass("busy")}),$vm.user="guest",t!==undefined&&t()},$vm.old_good_load_module=function(n){var u=n.callback,t=n.pid,c=n.db_pid,f=n.slot,i=n.url,r;if(i!==undefined){$("#D"+t).length===0&&($vm.vm[t]={}),$vm.vm[t].parent_uid=undefined,$vm.vm[t].parent_name="",$vm.vm[t].excel_dialog="";for(r in n)$vm.vm[t][r]=n[r];var s=function(){var u,r,n;$("#D"+t).length==0?(u=localStorage.getItem(i+"_ver"),r=localStorage.getItem(i+"_txt"),u!==$vm.version||$vm.debug===!0||r==null?(n=i+"?v_="+$vm.version,i.indexOf("?")!==-1&&(n=i+"&v_="+$vm.version),console.log("LOAD MODULE FROM "+n),$.get(n,function(n){localStorage.setItem(i+"_txt",n),localStorage.setItem(i+"_ver",$vm.version),e(n)})):e(r)):o()},e=function(n){var t=function(n){for(var r=n.split("\n"),u,f,t=0;t<r.length;t++)if(r[t].length>10&&r[t].indexOf("VmInclude:")!==-1){i(r,t);return}u=function(n){for(var i="",t=0;t<n.length;t++)i+=n[t]+"\n";return i},f=u(r),h(f),o()},i=function(n,i){var e=function(n,t,i){var u,r;for(n[t]=i,u="",r=0;r<n.length;r++)u+=n[r]+"\n";return u},h=n[i].replace("VmInclude:","").trim(),r=h.split("|"),u=$vm.url(r[0]),c=localStorage.getItem(u+"_ver"),o=localStorage.getItem(u+"_txt"),f,s;c!==$vm.version||$vm.debug===!0||o==null?(f=u+"?v_="+$vm.version,u.indexOf("?")!==-1&&(f=u+"&v_="+$vm.version),console.log("LOAD INCLUDE FROM "+f),$.get(f,function(f){var o,s,h,c,l;if(r.length>1)for(o=0;o<(r.length-1)/2;o++)s=2*o+1,h=2*o+2,s<r.length&&h<r.length&&(c=new RegExp(r[s],"g"),f=f.replace(c,r[h]));localStorage.setItem(u+"_txt",f),localStorage.setItem(u+"_ver",$vm.version),l=e(n,i,f),t(l)},"text")):(s=e(n,i,o),t(s))};t(n)},h=function(n){n=$vm.url(n);var i=n.replace(/__ID__/g,t);i=i.replace(/__ID/g,t),i=i.replace(/<!--([\s\S]*?)-->/mig,""),i="<div id=D"+t+" class=vm_module>"+i+"<\/div>",$("#D"+t).remove(),$("#vm_park").append($(i)),typeof window["F"+t]=="function"&&eval("F"+t+"()");$("#D"+t).on("dblclick",function(n){n.stopPropagation(),$vm.source(""+t,n)});$vm.vm_module_border!==undefined&&$("div.vm_module").css("border","1px solid red")},o=function(){f!="body"&&$vm.insert_module({pid:t,slot:f}),$("#D"+t).triggerHandler("load"),u!==undefined&&u()};s()}},$vm.insert_module=function(n){var t,i,u,r,f;if(($vm.page_stack==undefined&&($vm.page_stack=[],$vm.page_stack_index=0),t=n.pid,i=n.slot,t!==undefined)&&i!==undefined&&i!=""){u=$vm.page_stack.length,u!=0&&(r=$vm.page_stack[u-1],r!=undefined&&r.slot==i&&($("#D"+r.ID).css("display","none"),$("#D"+r.ID).triggerHandler("hide"))),$("#D"+t).css("display","block"),$("#D"+t).triggerHandler("show"),$vm.page_stack_index++,$vm.page_stack.push({ID:t,slot:i,index:$vm.page_stack_index}),window.history.pushState({ID:t,slot:i,index:$vm.page_stack_index},null,null),console.log($vm.page_stack);return}},window.onpopstate=function(n){var u=n.state.index,r=0,i=$vm.page_stack.length,f,t;i>1&&(f=$vm.page_stack[i-2],r=f.index),u==r?(t=$vm.page_stack.pop(),t!=undefined&&($("#D"+t.ID).css("display","none"),$("#D"+t.ID).triggerHandler("hide")),$vm.page_stack.length==0?window.history.back(-1):(i=$vm.page_stack.length,t=$vm.page_stack[i-1],$("#D"+t.ID).css("display","block"),$("#D"+t.ID).triggerHandler("show"))):u>r&&(i=$vm.page_stack.length,t=$vm.page_stack[i-1],$("#D"+t.ID).css("display","none"),$("#D"+t.ID).triggerHandler("hide"),$("#D"+n.state.ID).css("display","block"),$("#D"+n.state.ID).triggerHandler("show"),$vm.page_stack.push(n.state)),console.log($vm.page_stack);return},$vm.push_back_to_park=function(n){var t=n.div,i;$("#D"+t).length>0&&(i=$("#vm_body").scrollTop(),$("#D"+t).data("scroll",i),$("#D"+t).css("display","none"),$("#D"+t).triggerHandler("hide"))},$vm.push_to_slot=function(n){var i=n.div,r=n.slot,t;$("#D"+i).css("display","block"),$("#D"+i).triggerHandler("show"),t=$("#D"+i).data("scroll"),t==undefined&&(t=0),$("#vm_body").scrollTop(t)},$vm.back=function(n){var i=n.div,t=$("#D"+i).data("back_module"),u=$("#D"+i).data("back_slot"),f,r;$vm.push_back_to_park({div:i}),$vm.push_to_slot({div:t,slot:u}),$("#"+u).data("current",t),f=n.form,r=n.refresh_back,f!==undefined?r===undefined?$("#D"+t).triggerHandler("form_back"):r!==undefined&&$("#D"+t).triggerHandler("refresh_back"):$("#D"+t).triggerHandler("back")},$vm.back_and_refresh=function(n){var t=n.div,i=$("#D"+t).data("back_module"),r=$("#D"+t).data("back_slot");$vm.push_back_to_park({div:t}),$vm.push_to_slot({div:i,slot:r}),$("#"+r).data("current",i),$("#D"+i).triggerHandler("refresh_back")},$vm.load_first_module=function(n){var t=$vm.first_module,i=$vm.first_module_src,r;n!==undefined&&(t=n.url,i=n.src),r={pid:$vm.id(t),slot:"vm_body",url:$vm.url(t),source:i},$vm.load_module(r)},$vm.load_first_module_to_body=function(n){$vm.load_module({pid:$vm.id(),slot:"body",url:$vm.url(n.url),callback:n.callback})},$vm.open_dialog=function(n){var t=n.name,i,r,u;$vm.module_list[t]!==undefined&&(Array.isArray($vm.module_list[t])===!0?(i=$vm.module_list[t][0],r=$vm.module_list[t][1]):(i=$vm.module_list[t].table_id,r=$vm.module_list[t].url),u=$vm.module_list[t].id,$("#D"+u).css("display","block"))},$vm.close_dialog=function(n){var t=n.name,i,r,f,u;$vm.module_list[t]!==undefined&&(Array.isArray($vm.module_list[t])===!0?(i=$vm.module_list[t][0],r=$vm.module_list[t][1]):(i=$vm.module_list[t].table_id,r=$vm.module_list[t].url),f=$vm.id(r+i),u=$vm.module_list[t].id,$("#D"+u).css("display","none"))},$vm.load_module_to_park=function(){var n=optioms.name,i,t,r;Array.isArray($vm.module_list[n])===!0?(i=$vm.module_list[n][0],t=$vm.module_list[n][1]):(i=$vm.module_list[n].table_id,t=$vm.module_list[n].url),r={name:n,pid:$vm.id(t+i),url:$vm.url(t)},$vm.load_module(r)},$vm.get_module_id=function(n){return $vm.module_list[n.name].id},$vm.get_module=function(n){return $("#D"+$vm.module_list[n.name].id)},$vm.load_module_by_name=function(n,t,i,r){var s,e,f,h,o,u;if(n!==undefined){if($vm.module_list[n]===undefined){alert("The module '"+n+"' is not in the module list.");return}Array.isArray($vm.module_list[n])===!0?(s=$vm.module_list[n][0],e=$vm.module_list[n][1]):(s=$vm.module_list[n].table_id,e=$vm.module_list[n].url),f=$vm.module_list[n].id,f==undefined&&(f=$vm.id()),$vm.module_list[n].id=f,h={name:n,pid:f,slot:t,url:$vm.url(e),op:i,callback:r},$vm.load_module(h),o=document.title.split("|").pop(),u=$vm.module_list[n].name_for_search,u==undefined&&(u=""),u=u!=""?u+" | "+o:o,document.title=u}},$vm.alert=function(n){$vm.open_dialog({name:"alert_dialog_module"});var t=$vm.module_list.alert_dialog_module.table_id,i=$vm.module_list.alert_dialog_module.url,u=$vm.id(i+t),r=$vm.module_list["alert_dialog_module"].id;$("#message"+r).text(n)},$vm.close_alert=function(){$vm.close_dialog({name:"alert_dialog_module"})},$vm.table_id=function(n,t){var u=$vm.vm[n].name,i=$vm.module_list[u][t],r;return i===undefined?(alert("The module doesn't contain the parameter name: "+t),""):(r=$vm.module_list[i],r===undefined)?(alert("Can not find "+i+" in the module list."),""):r.table_id},$vm.attr=function(n,t){var r=$vm.vm[n].name,i=$vm.module_list[r][t];return i===undefined?(alert("The module doesn't contain the attr name: "+t),""):i},$vm.load_module_content=function(n,t){var r=localStorage.getItem(n+"_ver"),i=localStorage.getItem(n+"_txt");r!=$vm.version||i===null||$vm.debug===!0||$vm.reload!=""?(console.log("loading "+n+"?_="+$vm.version+$vm.reload),$.get(n+"?_="+$vm.version+$vm.reload,function(i){localStorage.setItem(n+"_txt",i),localStorage.setItem(n+"_ver",$vm.version),t!=undefined&&t(i)},"text").fail(function(){alert("The module content file ("+n+") doesn't exist!")})):t!=undefined&&t(i)},$vm.process_first_include=function(n,t,i,r,u,f){for(var o=n.split("\n"),e=0;e<o.length;e++)if(o[e].length>10&&o[e].indexOf("VmInclude:")!==-1){$vm.load_include(o,e,t,i,r,u,f);return}},$vm.load_include=function(n,t,i,r,u,f,e){var v=n[t].replace("VmInclude:","").trim(),s=v.split("|"),o=$vm.url(s[0]),h,c;o[0]=="/"&&(o=$vm.hosting_path+o),o=o.replace("__CURRENT_PATH__",$vm.vm[i].current_path);var y=localStorage.getItem(o+"_ver"),a=localStorage.getItem(o+"_txt"),l=0;o.indexOf("http://127.0.0.1")!=-1||o.indexOf("http://localhost")!=-1?l=1:$vm.localhost==!0&&o.indexOf("http://")==-1&&o.indexOf("https://")==-1&&(l=1,o=o[0]=="/"?$vm.hosting_path+o:$vm.hosting_path+"/"+o),y!=$vm.version||l==1||a==null||$vm.reload!=""?(h=o+"?_v="+($vm.version+$vm.reload).replace(/\./,"")+"&g="+_g_vm_chrom_loop++,o.indexOf("?")!==-1&&(h=o+"&_v="+($vm.version+$vm.reload).replace(/\./,"")+"&g="+_g_vm_chrom_loop++),console.log("loading from url. "+h),$.get(h,function(h){var c,a,v,y,l;if(s.length>1)for(c=0;c<(s.length-1)/2;c++)a=2*c+1,v=2*c+2,a<s.length&&v<s.length&&(y=new RegExp(s[a],"g"),h=h.replace(y,s[v]));localStorage.setItem(o+"_txt",h),localStorage.setItem(o+"_ver",$vm.version),l=$vm.replace_and_recreate_content(n,t,h),l.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(l,i,f,r,e),$vm.insert_and_trigger_load(i,r,u)):$vm.process_first_include(l,i,r,u,f,e)},"text")):(console.log("loading from stotage. "+o),c=$vm.replace_and_recreate_content(n,t,a),c.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(c,i,f,r,e),$vm.insert_and_trigger_load(i,r,u)):$vm.process_first_include(c,i,r,u,f,e))},$vm.replace_and_recreate_content=function(n,t,i){var u,r;for(n[t]=i,u="",r=0;r<n.length;r++)u+=n[r]+"\n";return u},$vm.create_module_and_run_code=function(n,t,i,r,u){var f,e,o;if(n=n.replace(/__CURRENT_PATH__/g,$vm.vm[t].current_path),f=n,u!=undefined&&$vm.module_list[u]!=undefined&&$vm.module_list[u].full_content!=="1"&&(e=$(f).filter("#D__ID").html(),e!=undefined&&e!=""&&(f=e)),f=$vm.url(f),u!=undefined&&$vm.module_list[u]!=undefined&&$vm.module_list[u].html_filter!=undefined&&(f=$vm.module_list[u].html_filter(f)),f=f.replace(/__ID/g,t),f=f.replace(/<!--([\s\S]*?)-->/mig,""),r!="body"?(f="<div id=D"+t+" module='"+u+"' class=vm_module style='display:none'><!--"+i+"-->"+f+"<\/div>",$("#D"+t).remove(),(r==""||r==undefined)&&(r=$vm.root_layout_content_slot),$("#"+r).append($(f))):$("body").append($(f)),typeof window["F"+t]=="function")try{eval("F"+t+"()")}catch(s){o=i,o===undefined&&(o=t),alert(s+"\r\nThis error happend in the module\r\n"+o)}$("#D"+t).on("dblclick",function(n){n.stopPropagation(),$vm.source(""+t,n)});$vm.vm_module_border!==undefined&&$("div.vm_module").css("border","1px solid red")},$vm.insert_and_trigger_load=function(n,t,i){t!="body"&&($vm.insert_module({pid:n,slot:t}),$("#D"+n).triggerHandler("load")),i!==undefined&&i(),$("#vm_loader").hide()},$vm.show_module=function(n,t,i){if($vm.vm[n].op!=undefined&&i!=undefined)for(var r in i)$vm.vm[n].op[r]=i[r];$vm.insert_module({pid:n,slot:t}),$("#D"+n).triggerHandler("load")},_g_current_path="",$vm.load_module=function(n){var l,s,c,e,o;_g_vm_chrom_loop=0;var u=n.name,f=n.callback,i=n.pid,y=n.db_pid,r=n.slot,t=n.url;if(t[0]=="/"&&(t=$vm.hosting_path+t),l=t.split("/").pop(),_g_current_path=t.replace(l,""),t!==undefined){$("#D"+i).length===0&&($vm.vm[i]={}),$vm.vm[i].parent_uid=undefined,$vm.vm[i].parent_name="",$vm.vm[i].excel_dialog="",$vm.vm[i].current_path=_g_current_path;for(s in n)$vm.vm[i][s]=n[s];if($vm.vm[i].input=n.op,$("#D"+i).length==0){t.indexOf("http://")==-1&&t.indexOf("https://")==-1&&(t=$vm.hosting_path+"/"+t);var v=localStorage.getItem(t+"_ver"),a=localStorage.getItem(t+"_txt"),h=0;t.indexOf("http://127.0.0.1")!=-1||t.indexOf("http://localhost")!=-1?h=1:$vm.localhost==!0&&t.indexOf("http://")==-1&&t.indexOf("https://")==-1&&(h=1,t=t[0]=="/"?$vm.hosting_path+t:$vm.hosting_path+"/"+t),c=0,window.location.toString().indexOf("reload="+u)!=-1&&(c=1),v!=$vm.version||h==1||a==null||$vm.reload!=""||c==1?(e=t+"?_v="+($vm.version+$vm.reload).replace(/\./,""),t.indexOf("?")!==-1&&(e=t+"&_v="+($vm.version+$vm.reload).replace(/\./,"")),console.log("loading from url. "+e),window.location.hostname!="127.0.0.1"&&window.location.hostname!="localhost"&&$("#vm_loader").show(),$.get(e,function(n){var s,o;n.indexOf("__CURRENT_NAME__")!=-1&&(s=e.split("/").pop().split("?")[0],n=n.replace(/__CURRENT_NAME__/g,s)),localStorage.setItem(t+"_txt",n),localStorage.setItem(t+"_ver",$vm.version),o=n,o.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(o,i,t,r,u),$vm.insert_and_trigger_load(i,r,f)):$vm.process_first_include(o,i,r,f,t,u)}).fail(function(){alert("The file '"+t+"' doesn't exist!")})):(console.log("loading from stotage. "+t),o=a,o.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(o,i,t,r,u),$vm.insert_and_trigger_load(i,r,f)):$vm.process_first_include(o,i,r,f,t,u))}else $vm.insert_and_trigger_load(i,r,f)}},$vm.modify_record=function(n){var r=n.pid,u=n.records,t=n.I,e=n.row_data,h=n.dbv,f=n.callback,c=u[t].ID,i="0",s;if($vm.vm[r]!==undefined&&$vm.vm[r].db_pid!==undefined&&(i=$vm.vm[r].db_pid),i=="0"){alert("No db pid");return}var l=$("#excel"+r).handsontable("getInstance"),a=l.getCell(t,0),o=$(a).closest("tr");o.find("input[type=file]").each(function(){var i=this.files.length;if(i===1){var n=$(this).closest("td"),t=n.data("filename_field"),r=e[t];n.data("filename",r),e[t]="upload unsuccessful"}}),s={cmd:"modify_record",rid:c,db_pid:i.toString(),data:e,dbv:h},$VmAPI.request({data:s,callback:function(n){u[t].dirty="0",u[t].valid="1";var r=0;o.find("input[type=file]").each(function(){var o=$(this).closest("td"),n,e;r=this.files.length,r===1&&(n=this.files[0],e=u[t].ID,$vm.uploading({file:n,ID:i,rid:e,filename:n.name,callback:function(){var u=o.data("filename"),s=o.data("filename_field"),n={},t,r;n[s]=u,t={},r={cmd:"modify_record",rid:e,db_pid:i,data:n,dbv:t},$VmAPI.request({data:r,callback:function(n){f!==undefined&&f(n,1)}})}}),$(this).closest("form")[0].reset())}),r===0&&f!==undefined&&f(n,1)}})},$vm.modify_record_v2=function(n){var f=n.pid,r=n.records,i=n.I,e=n.row_data,h=n.dbv,u=n.callback,c=r[i].ID,t=undefined,s;if(t=f!==undefined?$vm.vm[f].db_pid:n.db_pid,t==undefined){alert("No db pid");return}var l=$("#excel"+f).handsontable("getInstance"),a=l.getCell(i,0),o=$(a).closest("tr");o.find("input[type=file]").each(function(){var i=this.files.length;if(i===1){var n=$(this).closest("td"),t=n.data("filename_field"),r=e[t];n.data("filename",r),e[t]="upload unsuccessful"}}),s={cmd:"modify_record",rid:c,db_pid:t.toString(),data:e,dbv:h},$VmAPI.request({data:s,callback:function(n){r[i].dirty="0",r[i].valid="1";var f=0;o.find("input[type=file]").each(function(){var o=$(this).closest("td");if(f=this.files.length,f===1){var n=this.files[0],e=r[i].ID,s=function(){var f=o.data("filename"),s=o.data("filename_field"),n={},i,r;n[s]=f,i={},r={cmd:"modify_record",rid:e,db_pid:t,data:n,dbv:i},$VmAPI.request({data:r,callback:function(n){u!==undefined&&u(n,"modify")}})};$vm.uploading_v2({file:n,ID:t,rid:e,filename:n.name,callback:function(){n.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)?$vm.uploading_thumb_image({file:n,ID:t,rid:e,filename:n.name,callback:function(){s()}}):s()}}),$(this).closest("form")[0].reset()}}),f===0&&u!==undefined&&u(n,"modify")}})},$vm.grid_modify_record=function(n){var o=n.pid,r=n.records,u=n.I,t=n.row_data,s=n.dbv,f=n.callback,h=n.tr,c=r[u].ID,i=undefined,e;if(i=o!==undefined?$vm.vm[o].db_pid:n.db_pid,i==undefined){alert("No db pid");return}h.find("input[type=file]").each(function(){var r=this.files.length;if(r===1){var n=$(this).closest("td"),i=n.data("filename_field"),u=t[i];n.data("filename",u),t[i]="upload unsuccessful"}}),e={cmd:"modify_record",rid:c,db_pid:i.toString(),data:t,dbv:s},n.json==1&&(e={cmd:"modify_json_record",rid:c,db_pid:i.toString(),data:t,dbv:s}),$VmAPI.request({data:e,callback:function(t){r[u].dirty="0",r[u].valid="1";var i=0,e=function(n){i--,i==0&&f(n,"modify")};h.find("input[type=file]").each(function(){var t=this.files.length;t===1&&i++,$vm.td_upload_file_for_modify(this,e,n)}),i===0&&f!==undefined&&f(t,"modify")}})},$vm.td_upload_file_for_modify=function(n,t,i){var o=i.pid,s=i.records,h=i.I,v=i.row_data,y=i.dbv,a=i.callback,p=i.tr,u=s[h].ID,f=undefined,e,c;if(f=o!==undefined?$vm.vm[o].db_pid:i.db_pid,e=$(n).closest("td"),c=n.files.length,c===1){var r=n.files[0],u=s[h].ID,l=function(){var o=e.data("filename"),s=e.data("filename_field"),n={},i,r;n[s]=o,i={},r={cmd:"modify_record",rid:u,db_pid:f,data:n,dbv:i},$VmAPI.request({data:r,callback:function(n){a!==undefined&&t(n,"modify")}})};$vm.uploading_v2({file:r,ID:f,rid:u,filename:r.name,callback:function(){r.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)?$vm.uploading_thumb_image({file:r,ID:f,rid:u,filename:r.name,callback:function(){l()}}):l()}}),$(n).closest("form")[0].reset()}},$vm.modify_record_s2=function(n){var o=n.pid,r=n.records,u=n.I,t=n.row_data,s=n.dbv,f=n.callback,h=n.tr,c=r[u].ID,i=undefined,e;if(i=o!==undefined?$vm.vm[o].db_pid:n.db_pid,i===undefined){alert("No db pid");return}h.find("input[type=file]").each(function(){var r=this.files.length;if(r===1){var n=$(this).closest("td"),i=n.data("filename_field"),u=t[i];n.data("filename",u),t[i]="upload unsuccessful"}}),e={cmd:"modify_record_s2",rid:c,db_pid:i.toString(),data:t,dbv:s},n.json==1&&(e={cmd:"modify_json_record_s2",rid:c,db_pid:i.toString(),data:t,dbv:s}),$VmAPI.request({data:e,callback:function(t){r[u].dirty="0",r[u].valid="1";var i=0,e=function(n){i--,i==0&&f(n,"modify")};h.find("input[type=file]").each(function(){var t=this.files.length;t===1&&i++,$vm.td_upload_file_for_modify_s2(this,e,n)}),i===0&&f!==undefined&&f(t,"modify")}})},$vm.td_upload_file_for_modify_s2=function(n,t,i){var o=i.pid,s=i.records,h=i.I,v=i.row_data,y=i.dbv,a=i.callback,p=i.tr,u=s[h].ID,f=undefined,e,c;if(f=o!==undefined?$vm.vm[o].db_pid:i.db_pid,e=$(n).closest("td"),c=n.files.length,c===1){var r=n.files[0],u=s[h].ID,l=function(){var o=e.data("filename"),s=e.data("filename_field"),n={},i,r;n[s]=o,i={},r={cmd:"modify_record_s2",rid:u,db_pid:f,data:n,dbv:i},$VmAPI.request({data:r,callback:function(n){a!==undefined&&t(n,"modify")}})};$vm.uploading_v2({file:r,ID:f,rid:u,filename:r.name,callback:function(){r.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)?$vm.uploading_thumb_image({file:r,ID:f,rid:u,filename:r.name,callback:function(){l()}}):l()}}),$(n).closest("form")[0].reset()}},$vm.nav_click_process=function(n,t){switch(n){case"vm_signinout":$vm.user=="guest"?window.open($VmAPI.api_base+"signin.html?url="+window.location.href,"Sign In","width=600, height=600"):($VmAPI.clear_token(),$VmAPI.request({data:{cmd:"signout"},callback:function(){$vm.user="guest",$vm.user_id="",location.reload(!0)}}));break;default:n=="dev"?$vm.alert("Under development"):$vm.nav_load_module(n,t)}},$vm.nav_load_module=function(n,t,i){var r,e,u,o,f;if($vm.app_config.modules!=undefined&&$vm.app_config.modules[n]!=undefined&&$vm.app_config.modules[n].url!=undefined&&$vm.module_list[n]==undefined&&($vm.module_list[n]=$vm.app_config.modules[n]),$vm.module_list[n]==undefined){alert(n+" is not in the module list.");return}if(r=$vm.module_list[n].url,r.split(".").pop().split("?")[0]=="json"){$vm.nav_load_panel(n);return}r[0]=="/"&&$vm.hosting_path!=undefined&&(r=$vm.hosting_path+r),e=$vm.module_list[n].single_record,u=$vm.app_config,i!=undefined?u=i:$vm.module_list[n].config!=undefined&&(u=$vm.module_list[n].config),o={sys:{config:u,UID:n},input:i},f=$vm.root_layout_content_slot,t!=undefined&&t!=""&&(f=t),(e=="1"||t=="hidden")&&(f=undefined),$vm.load_module_by_name(n,f,o)},$vm.load_module_v2=function(n,t,i){i==undefined&&(i={});var r=$vm.root_layout_content_slot;t!=undefined&&t!=""&&(r=t),t=="hidden"&&(r=undefined),$vm.load_module_by_name(n,r,i)},$vm.nav_load_panel=function(n){var t=$vm.module_list[n].url;t[0]=="/"&&$vm.hosting_path!=undefined&&(t=$vm.hosting_path+t),console.log("loading "+t),$.get(t,function(t){var t=$("<div><\/div>").html(t).text(),r,i;try{r=JSON.parse(t)}catch(u){alert("Error in config file\n"+u);return}i=n+"_panel",$vm.module_list[i]==undefined&&($vm.module_list[i]={url:r.url,"var":{}}),$vm.load_module_by_name(i,$vm.root_layout_content_slot,{sys:{config:r,UID:n}})},"text").fail(function(){alert("The file '"+t+"' doesn't exist!")})},$vm.nav_wappsystem_signin=function(){$vm.user=="guest"&&window.open($VmAPI.api_base+"signin.html?url="+window.location.href,"Sign In","width=600, height=700")},$vm.nav_signout=function(){if($vm.user_puid=="1"){var n=gapi.auth2.getAuthInstance();n.signOut()}else $vm.user_puid=="2"&&FB.logout(function(){});$VmAPI.clear_token(),$VmAPI.request({data:{cmd:"signout"},callback:function(){location.reload(!0)}})},$vm.nav_signout_without_reload=function(){if($vm.user_puid=="1"){var n=gapi.auth2.getAuthInstance();n.signOut()}else $vm.user_puid=="2"&&FB.logout(function(){});$VmAPI.clear_token(),$VmAPI.request({data:{cmd:"signout"},callback:function(){}})},$vm.postcode_suburb=function(n){var t=n.query,i=n.process},$vm.auto_postcode_list=function(n){for(var r=$.parseJSON(n),u=[],i,t=0;t<r.length;t++)i={},i.value=r[t],i.suburb=r[t].split("/")[0],i.state=r[t].split("/")[1],i.postcode=r[t].split("/")[2],u.push(i);return u},$vm.autocomplete_list=function(n){for(var r=[],i,t=0;t<n.length;t++){i={},i.label=n[t].name;for(key in n[t])key!="name"&&(i[key]=n[t][key]);r.push(i)}return r},$vm.read_record_auto=function(n){var i=n.query,r=n.minLength,u=n.process,t=n.callback;$VmAPI.request({data:{cmd:"auto",s1:i,sql:n.sql,minLength:r},callback:function(n){for(var f=[],e={},r,i=0;i<n.table.length;i++)r=n.table[i].Item.trim(),f.push(r),e[r]=n.table[i].Value;u(f),t!==undefined&&t(e)}})},$vm.auto_input=function(n){var t=n.input_id,i=n.minLength,r=n.callback;$("#"+t).autocomplete({minLength:i,source:function(t,r){$VmAPI.request({data:{cmd:"auto",s1:t.term,sql:n.sql,minLength:i},callback:function(n){for(var u=n.table,f=[],i,t=0;t<u.length;t++)i={},i.label=u[t].Name,i.value=u[t].Value,f.push(i);r(f)}})},select:function(n,t){r!==undefined&&r(n,t)}}),i===0&&$("#"+t).focus(function(){$("#"+t).autocomplete("search","")})},$vm.deserialize=function(n,t){n!=undefined&&$.each(n,function(n,i){if(n!=""){var r=$(t+" *[name="+n+"]");r.each(function(){var n=$(this),t=n.attr("type");switch(t){case"checkbox":i=="off"||i=="0"||i==""?n.prop("checked",!1):n.prop("checked",!0);break;case"radio":n.attr("value")==i&&n.prop("checked",!0);break;case"file":break;case"text":case"email":case"textarea":case"select":n.val(i);break;case"undefined":break;default:n.val(i)}})}})},$vm.serialize=function(n){var t={},i=$(n).serializeArray();return $.each(i,function(){t[this.name]=this.value||""}),$(n+" input:checkbox:not(:checked)").each(function(){t[this.name]="off"}),t},$vm.google_signin_setup=function(n,t,i){$.getScript("https://apis.google.com/js/platform.js",function(){gapi.load("auth2",function(){auth2=gapi.auth2.init({client_id:n,cookiepolicy:"single_host_origin"});var r=document.getElementById(t);auth2.attachClickHandler(r,{},function(n){$vm.user_google_token=n.getAuthResponse().id_token,$VmAPI.request({data:{cmd:"signin_google",token:$vm.user_google_token},callback:function(n){$VmAPI.set_token(n.token,n.api_url,n.username,n.user_id,n.nickname),n.user!==undefined?($vm.user=n.user,$vm.user_id=n.user_id,$vm.user_ip=n.user_ip,$vm.user_puid=n.user_puid,i(n)):alert("Signin error")}})},function(){})})})},$vm.facebook_signin_setup=function(n,t,i){window.fbAsyncInit=function(){FB.init({appId:n,cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(n,t,i){var r,u=n.getElementsByTagName(t)[0];n.getElementById(i)||(r=n.createElement(t),r.id=i,r.src="https://connect.facebook.net/en_US/sdk.js",u.parentNode.insertBefore(r,u))}(document,"script","facebook-jssdk");$("#"+t).on("click",function(){FB.login(function(n){n.status==="connected"&&($vm.user_facebook_token=n.authResponse.accessToken,$VmAPI.request({data:{cmd:"signin_facebook",token:$vm.user_facebook_token},callback:function(n){$VmAPI.set_token(n.token,n.api_url,n.username,n.user_id,n.nickname),n.user!==undefined?($vm.user=n.user,$vm.user_id=n.user_id,$vm.user_ip=n.user_ip,$vm.user_puid=n.user_puid,i(n)):alert("Signin error")}}))},{scope:"email"})})},$vm.iframe_height=function(){var n=$("#content_slot").outerHeight(!0),t={cmd:"height",height:n};window.parent.postMessage(t,"*")},$vm.msg_id=0,$vm.callback_array=[],$vm.post_message_from_child_to_parent=function(n){var t=n.data;console.log(" "),console.log(t.cmd+" TO parent"),console.log(t),t.ID=$vm.msg_id,$vm.callback_array.push({callback:n.callback,ID:$vm.msg_id}),window.opener.postMessage(t,n.origin),$vm.msg_id++},$vm.process_message_from_child=function(n){var t=n.data;t.cmd!=undefined&&$VmAPI.request({data:t,callback:function(i){i.ID=t.ID,i.cmd=t.cmd,n.source.postMessage(i,n.origin)}})},$vm.process_message_from_parent=function(n){var t=n.data,r;for(console.log(" "),console.log(t.cmd+" FROM parent"),console.log(t),i=0;i<$vm.callback_array.length;i++)if(r=$vm.callback_array[i],r.ID==t.ID){r.callback(t),$vm.callback_array.splice(i,1);break}}